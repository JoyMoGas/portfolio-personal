---
import { getCollection } from "astro:content";
import Layout from "../../../layouts/Layout.astro";
import { getLangFromUrl, useTranslations } from "../../../i18n/utils";
import { languages } from "../../../i18n/ui";

export async function getStaticPaths() {
  const allProjects = await getCollection("projects");

  const paths = allProjects.map((project) => {
    const slug = project.slug.split("/").pop();
    return {
      params: {
        lang: project.data.lang,
        slug: slug,
      },
      props: { project },
    };
  });

  return paths;
}

const { project } = Astro.props;
const { Content } = await project.render();

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<Layout title={project.data.title}>
  <main class="container mx-auto px-4 py-12 max-w-4xl">
    <!-- Back button -->
    <a
      href={`/${lang}/projects`}
      class="text-blue-600 hover:underline mb-6 inline-block"
    >
      ‚Üê {t("nav.projects")}
    </a>

    <!-- Project header -->
    <header class="mb-8">
      <h1 class="text-4xl font-bold mb-4">{project.data.title}</h1>
      <p class="text-xl text-gray-600 mb-6">{project.data.description}</p>

      {
        project.data.image && (
          <img
            src={project.data.image}
            alt={project.data.title}
            class="w-full h-96 object-cover rounded-lg mb-6"
          />
        )
      }

      <!-- Technologies -->
      <div class="flex flex-wrap gap-2 mb-6">
        {
          project.data.technologies.map((tech) => (
            <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full">
              {tech}
            </span>
          ))
        }
      </div>

      <!-- Links -->
      <div class="flex gap-4">
        {
          project.data.demo && (
            <a
              href={project.data.demo}
              target="_blank"
              rel="noopener noreferrer"
              class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition"
            >
              {t("projects.viewDemo")}
            </a>
          )
        }
        {
          project.data.github && (
            <a
              href={project.data.github}
              target="_blank"
              rel="noopener noreferrer"
              class="px-4 py-2 bg-gray-800 text-white rounded hover:bg-gray-900 transition"
            >
              {t("projects.viewCode")}
            </a>
          )
        }
      </div>
    </header>

    <!-- Project content (markdown) -->
    <article class="prose prose-lg max-w-none">
      <Content />
    </article>
  </main>
</Layout>

<style>
  /* Styling for markdown content */
  article :global(h1) {
    @apply text-3xl font-bold mt-8 mb-4;
  }

  article :global(h2) {
    @apply text-2xl font-semibold mt-6 mb-3;
  }

  article :global(p) {
    @apply mb-4 text-gray-700 leading-relaxed;
  }

  article :global(ul) {
    @apply list-disc list-inside mb-4 space-y-2;
  }

  article :global(code) {
    @apply bg-gray-100 px-2 py-1 rounded text-sm;
  }
</style>
