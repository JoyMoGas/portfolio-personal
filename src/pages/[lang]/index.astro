---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import profileImg from "../../assets/profile.webp";

import { getLangFromUrl, useTranslations } from "../../i18n/utils";
import Navbar from "../../components/Navbar.astro";
import { languages } from "../../i18n/ui";
import ProjectCard from "../../components/ProjectCard.astro";
import SkillsCard from "../../components/SkillsCard.astro";
import SkillInfo from "../../components/SkillInfo.astro";
import ContactSection from "../../components/ContactSection.astro";
import Footer from "../../components/Footer.astro";

export function getStaticPaths() {
  return Object.keys(languages).map((lang) => ({
    params: { lang },
  }));
}

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const titleString = t("home.title");
const availbaleButton = t("home.available");
const introString = t("home.intro");

const projectsString = t("projects.title");

const arsenalTtitle = t("arsenal.title");
const arsenalFront = t("arsenal.frontend");
const arsenalBack = t("arsenal.backend");
const arsenalTools = t("arsenal.tools");

const aboutTitle = t("about.title");
const aboutDescription = t("about.description");

const softwareTitle = t("about.softwareTitle");
const softwareContent = t("about.softwareContent");

const systemsTitle = t("about.systemsTitle");
const systemsContent = t("about.systemsContent");

const securityTitle = t("about.securityTitle");
const securityContent = t("about.securityContent");

const optimizationTitle = t("about.optimizationTitle");
const optimizationContent = t("about.optimizationContent");

// Get all projects for the current language, sorted by order
const allProjects = await getCollection("projects", ({ data }) => {
  return data.lang === lang;
});
const sortedProjects = allProjects.sort((a, b) => a.data.order - b.data.order);

const showSuccess = Astro.url.searchParams.get("success") === "true";
---

<Layout>
  <Navbar />
  <main class="mt-18 mx-10 max-w-7xl lg:mx-auto lg:px-10">
    <section class="mb-20 lg:mb-32">
      <div
        class="flex flex-col lg:flex-row items-center lg:justify-between lg:text-left text-center gap-10"
      >
        <div class="lg:w-1/2 flex flex-col items-center lg:items-start">
          <h1
            class="font-fraunces font-bold text-text-primary text-8 lg:text-14 mb-6"
            set:html={titleString}
          />

          <div class="hidden lg:block mb-8">
            <p
              class="text-text-secondary text-5 leading-relaxed"
              set:html={introString}
            />
          </div>
        </div>

        <article class="flex flex-col items-center lg:w-1/2">
          <div class="relative">
            <img
              src={profileImg.src}
              alt="Imagen del programador"
              class="w-80 lg:w-100 rounded-full mb-6"
            />
            <div
              class="lg:absolute lg:-bottom-4 lg:left-1/2 lg:-translate-x-1/2 bg-available border border-available-border rounded-full w-fit px-6 py-2 shadow-sm mx-auto"
            >
              <p
                class="font-jakarta text-text-accent font-bold text-xs uppercase tracking-widest whitespace-nowrap"
                set:html={availbaleButton}
              />
            </div>
          </div>

          <div class="mt-12 lg:hidden px-4">
            <p
              class="text-left text-4 leading-relaxed"
              set:html={introString}
            />
          </div>
        </article>
      </div>
    </section>

    <section id="projects" class="flex flex-col items-center mb-20 lg:mb-32">
      <h2
        class="font-fraunces text-text-primary text-6 lg:text-9 font-bold mb-12 uppercase tracking-wide"
        set:html={projectsString}
      />

      <div class="projects-grid w-full">
        {
          sortedProjects.map((project) => (
            <ProjectCard project={project} lang={lang} />
          ))
        }
      </div>
    </section>

    <section
      id="technologies"
      class="flex flex-col items-center mb-20 lg:mb-32"
    >
      <h2
        class="font-fraunces text-text-primary text-6 lg:text-9 font-bold mb-12 uppercase tracking-wide"
      >
        {arsenalTtitle}
      </h2>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-8 w-full">
        <SkillsCard
          title={arsenalFront}
          elements={[
            "React",
            "React Native",
            "TypeScript",
            "JavaScript",
            "Tailwind CSS",
            "Astro",
          ]}
        />

        <SkillsCard
          title={arsenalBack}
          elements={[
            "Python",
            "Flask",
            "DJango",
            "JWT",
            "PostgreSQL",
            "Supabase",
          ]}
        />

        <SkillsCard
          title={arsenalTools}
          elements={[
            "Vercel",
            "Git / Github",
            "Postman",
            "Web Scrapping",
            "VS Code",
            "Figma",
          ]}
        />
      </div>
    </section>

    <section id="about" class="mb-20 lg:mb-32">
      <h2
        class="font-fraunces text-text-primary text-6 lg:text-9 font-bold mb-12 uppercase tracking-wide text-center"
      >
        {aboutTitle}
      </h2>

      <div class="flex flex-col lg:flex-row gap-12 lg:gap-20">
        <div class="lg:w-1/3">
          <p
            class="text-left text-4 text-text-secondary leading-relaxed"
            set:html={aboutDescription}
          />
        </div>

        <div class="lg:w-2/3 grid grid-cols-1 sm:grid-cols-2 gap-8">
          <SkillInfo title={softwareTitle} content={softwareContent} />
          <SkillInfo title={systemsTitle} content={systemsContent} />
          <SkillInfo title={securityTitle} content={securityContent} />
          <SkillInfo title={optimizationTitle} content={optimizationContent} />
        </div>
      </div>
    </section>

    {
      showSuccess && (
        <div class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-text-accent text-text-buttons px-6 py-4 rounded-2xl shadow-2xl z-100 font-jakarta font-bold animate-bounce flex items-center gap-3 border border-white/20 backdrop-blur-md">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="3"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <polyline points="20 6 9 17 4 12" />
          </svg>
          {t("contact.success")}
        </div>
      )
    }

    <ContactSection />
  </main>

  <Footer />
</Layout>

<style>
  .projects-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 32px;
    width: 100%;
    margin: 0 auto;
  }

  @media (min-width: 900px) {
    .projects-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 40px;
    }
  }
</style>
