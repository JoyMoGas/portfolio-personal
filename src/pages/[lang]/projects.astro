---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import {
  getLangFromUrl,
  useTranslations,
  getProjectUrl,
} from "../../i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// Get all projects for the current language
const allProjects = await getCollection("projects", ({ data }) => {
  return data.lang === lang;
});

// Sort by order
const sortedProjects = allProjects.sort((a, b) => a.data.order - b.data.order);
const featuredProjects = sortedProjects.filter((p) => p.data.featured);
---

<Layout title={t("projects.title")}>
  <main class="container mx-auto px-4">

    <!-- Featured Projects -->
    {
      featuredProjects.length > 0 && (
        <section class="mb-12">
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {featuredProjects.map((project) => (
              <article class="border rounded-lg p-6 hover:shadow-lg transition-shadow">
                {project.data.image && (
                  <img
                    src={project.data.image}
                    alt={project.data.title}
                    class="w-full h-48 object-cover rounded-md mb-4"
                  />
                )}
                <h3 class="text-xl font-bold mb-2">{project.data.title}</h3>
                <p class="text-gray-600 mb-4">{project.data.description}</p>

                <div class="flex flex-wrap gap-2 mb-4">
                  {project.data.technologies.map((tech) => (
                    <span class="px-2 py-1 bg-blue-100 text-blue-800 text-sm rounded">
                      {tech}
                    </span>
                  ))}
                </div>

                <div class="flex gap-3">
                  <a
                    href={getProjectUrl(
                      project.slug.split("/").pop() || "",
                      lang,
                    )}
                    class="text-blue-600 hover:underline"
                  >
                    {t("projects.viewDetails")}
                  </a>
                  {project.data.demo && (
                    <a
                      href={project.data.demo}
                      target="_blank"
                      rel="noopener noreferrer"
                      class="text-green-600 hover:underline"
                    >
                      {t("projects.viewDemo")}
                    </a>
                  )}
                  {project.data.github && (
                    <a
                      href={project.data.github}
                      target="_blank"
                      rel="noopener noreferrer"
                      class="text-gray-600 hover:underline"
                    >
                      {t("projects.viewCode")}
                    </a>
                  )}
                </div>
              </article>
            ))}
          </div>
        </section>
      )
    }
  </main>
</Layout>
